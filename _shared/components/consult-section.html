<section class="consult section" id="consultation">
  <div class="container">
    <div class="consult-inner">
      <div class="consult-left">
        <h2>
          Get Your Free<br /><span class="highlight-amber"
            >Automation Audit</span
          >
        </h2>
        <p>
          Tell us about your business and our experts will identify the top 3
          processes you should automate first â€” with estimated time and cost
          savings.
        </p>
        <ul class="consult-benefits">
          <li>
            <span class="consult-check">âœ“</span> Free 30-minute expert
            consultation
          </li>
          <li>
            <span class="consult-check">âœ“</span> Custom automation roadmap for
            your business
          </li>
          <li>
            <span class="consult-check">âœ“</span> ROI estimate before you invest
            anything
          </li>
          <li>
            <span class="consult-check">âœ“</span> No obligation â€” the audit is
            yours to keep
          </li>
          <li>
            <span class="consult-check">âœ“</span> Response within 2 hours on
            business days
          </li>
        </ul>
        <div class="consult-urgency">
          ðŸ”¥ We take on only 5 new projects per month â€” limited spots available
        </div>
      </div>
      <div class="form-card">
        <h3>Book Your Free Audit</h3>
        <p class="form-card-sub">Takes less than 60 seconds</p>
        <!-- Inject consult form component here -->

        <form id="consultForm">
          <!-- Hidden fields for tracking -->
          <input
            type="hidden"
            name="page_url"
            id="pageUrl"
            class="form-hidden"
          />
          <input
            type="hidden"
            name="page_title"
            value="Homepage"
            class="form-hidden"
          />
          <input
            type="hidden"
            name="submitted_at"
            id="submittedAt"
            class="form-hidden"
          />

          <div class="form-row">
            <div class="form-group">
              <label for="nameInput">Full Name *</label>
              <input
                type="text"
                name="name"
                id="nameInput"
                placeholder="Your name"
                required
              />
            </div>
            <div class="form-group">
              <label for="companyInput">Company Name</label>
              <input
                type="text"
                name="company"
                id="companyInput"
                placeholder="Your company"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="emailInput">Email *</label>
              <input
                type="email"
                name="email"
                id="emailInput"
                placeholder="your@email.com"
                required
              />
            </div>
            <div class="form-group">
              <label for="phoneInput">Phone *</label>
              <input
                type="tel"
                name="phone"
                id="phoneInput"
                placeholder="+91 XXXXX XXXXX"
                required
              />
            </div>
          </div>
          <div class="form-group">
            <label for="serviceInput">What are you looking for?</label>
            <select name="service" id="serviceInput" required>
              <option value="">Select a service</option>
              <option value="ai-agents">AI Agents / Agentic AI</option>
              <option value="voice-ai">Voice AI Agent</option>
              <option value="chatbot">AI Chatbot</option>
              <option value="make-automation">Make.com Automation</option>
              <option value="n8n-automation">n8n Automation</option>
              <option value="power-automate">
                Power Automate / Power Apps
              </option>
              <option value="crm-automation">CRM Integration</option>
              <option value="custom-integration">Custom API Integration</option>
              <option value="not-sure">Not Sure â€” Need Guidance</option>
            </select>
          </div>
          <div class="form-group">
            <label for="messageInput">Tell us about your project</label>
            <textarea
              name="message"
              id="messageInput"
              placeholder="What processes do you want to automate? What's your biggest bottleneck?"
            ></textarea>
          </div>
          <button type="submit" class="form-submit" id="submitBtn">
            Get My Free Automation Audit â†’
          </button>
          <p class="form-note">
            ðŸ”’ Your information is secure. We never share your data.
          </p>
        </form>

        <script>
          // Attach submit handler after component is injected
          (function () {
            function attach() {
              var form = document.getElementById("consultForm");
              if (!form) return false;
              if (form.__attached) return true;
              form.__attached = true;

              form.addEventListener("submit", async function (e) {
                e.preventDefault();
                var btn = document.getElementById("submitBtn");
                if (btn) {
                  btn.textContent = "Sending...";
                  btn.disabled = true;
                }

                // Set hidden fields
                var pageUrl = document.getElementById("pageUrl");
                var submittedAt = document.getElementById("submittedAt");
                if (pageUrl) pageUrl.value = window.location.href;
                if (submittedAt) submittedAt.value = new Date().toISOString();

                var formData = new FormData(form);
                var data = {};
                formData.forEach(function (value, key) {
                  data[key] = value;
                });

                try {
                  var webhookUrl = "{{SITE.formWebhookUrl}}";
                  await fetch(webhookUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data),
                  });
                } catch (err) {
                  console.log("Webhook error:", err);
                }

                window.location.href = "{{SITE.thankYouPage}}";
              });

              return true;
            }

            // Try immediately and again shortly after (components may be injected async)
            if (!attach()) setTimeout(attach, 300);
          })();
        </script>
      </div>
    </div>
  </div>
</section>
